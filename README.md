# CSE330 Project-6 Storage Management

In this directory, you are provided with code which you will use to implement the project. 
- **dm_cache.c** This file contatins necessary device mapper functions and also the interface code which you will use to implement the project. **DO NOT EDIT THIS FILE**
- **dm_cache.h**: This is the header file **DO NOT EDIT THIS FILE**
- **dm.h**: This is the internal header file for device mapper. **DO NOT EDIT THIS FILE**
- **Makefile**: This will compile your code. 
- **dm_lru.c**: This is the ONLY file you need to make changes to. DO NOT EDIT any function signatures. Doing so will fail the test scripts and you will be given 0 grade points. 


The flowchart below illustrates how the major functions of dm-cache work together. Blue shaded functions are provided to you in dm_cache.c. Yellow shaded functions are what you need to implement in dm_lru.c.

<img width="765" alt="image" src="https://github.com/user-attachments/assets/f6354e69-2bee-4c7d-945e-2fe85f94dd70">

### How to test manually 

- **Preparations:**
  - Add a 2GB virtual disk (as the source device, say /dev/devX ) and a 1GB virtual disk (as the cache device, says its /dev/devY) to your VM
  - Install fio using apt. Fio is a I/O benchmark which we will use to exercise our cache.

- **Create the cache:**
  - Use the provided makefile to compile your kernel module and load it using insmod. 
  - Create the cache using the dmsetup command (man dmsetup for more information)
    `echo 0 4194304 cache /dev/devX/dev/devY 8 262144 | sudo dmsetup create cache`

- **Run workloads**
  - Issue a 10MB read workload to the cache 
    `sudo fio --filename=/dev/mapper/dm_cache --name=test --rw=read --direct=1 --size=10MB --numjobs=1`
    This workload will generate 2560 4K I/O requests, assuming the block size is 8.  Hence the dm_cache stats should exhibit the same.
  - Check the cache statistics using the command : `sudo dmsetup status cache`
    When you run the above workload on a cold cache, all reads should be misses; when you run it the second time, the cache is warm and all reads should be hits.

- **Remove the cache**  
  - To remove the cache device use `sudo dmsetup remove cache`

**Note:**
- Please do not make any changes in provided test case code to pass the test cases.
- You can use print statements in case you want to debug and understand the logic of the test code.
- Please get in touch with the TAs if you face any issues using the test scripts.


